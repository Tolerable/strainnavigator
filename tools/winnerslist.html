<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Basic Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Winner's List - An interactive random name picker tool. Perfect for choosing winners, making decisions, or adding excitement to your events and giveaways.">
    <title>Winner's List</title>
    <style>
        :root {
            --primary: #ff5252;
            --secondary: #ffeb3b;
            --accent: #2196f3;
            --dark: #212121;
            --light: #f5f5f5;
            --winner: #4CAF50;
            --eliminated: #ff0000;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial Rounded MT Bold', 'Helvetica Rounded', Arial, sans-serif;
        }
        
        body {
            background-color: #121212;
            color: white;
            background-image: radial-gradient(circle, #303030 1px, transparent 1px);
            background-size: 20px 20px;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            height: calc(100vh - 40px);
        }
        
        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
                height: auto;
            }
        }
        
        .header {
            grid-column: 1 / -1;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .title {
            font-size: 4rem;
            margin: 10px 0;
            color: var(--secondary);
            text-shadow: 
                0 0 5px var(--primary),
                0 0 10px var(--primary),
                0 0 15px var(--primary);
            animation: flicker 3s infinite alternate;
        }
        
        @keyframes flicker {
            0%, 18%, 22%, 25%, 53%, 57%, 100% {
                text-shadow: 
                    0 0 5px var(--primary),
                    0 0 10px var(--primary),
                    0 0 15px var(--primary);
            }
            20%, 24%, 55% {
                text-shadow: none;
            }
        }
        
        .subtitle {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--light);
        }
        
        .panel {
            background: rgba(20, 20, 20, 0.8);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            border: 2px solid var(--primary);
            position: relative;
            overflow: hidden;
        }
        
        .panel::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-conic-gradient(
                transparent 0deg 10deg,
                rgba(255, 82, 82, 0.1) 10deg 20deg
            );
            animation: rotate 120s linear infinite;
            z-index: -1;
        }
        
        @keyframes rotate {
            100% {
                transform: rotate(360deg);
            }
        }
        
        .panel-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            text-align: center;
            color: var(--secondary);
        }
        
        .name-list-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }
        
        .name-list {
            list-style: none;
            overflow-y: auto;
            flex-grow: 1;
            margin-bottom: 15px;
            position: relative;
        }
        
        .name-item {
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            margin-bottom: 8px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            position: relative;
        }
        
        .name-item:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .name-text {
            flex-grow: 1;
            margin-right: 10px;
        }
        
        .edit-btn, .delete-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 5px;
        }
        
        .edit-btn {
            background-color: var(--accent);
            color: white;
        }
        
        .delete-btn {
            background-color: var(--primary);
            color: white;
        }
        
        .add-name-form {
            display: flex;
            margin-top: auto;
        }
        
        .name-input {
            flex-grow: 1;
            padding: 10px 15px;
            border: 2px solid var(--accent);
            border-radius: 8px 0 0 8px;
            font-size: 1rem;
            background: rgba(0, 0, 0, 0.2);
            color: white;
        }
        
        .add-btn {
            padding: 10px 20px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 0 8px 8px 0;
            cursor: pointer;
            font-weight: bold;
        }
        
        .settings-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .form-label {
            font-size: 1rem;
            color: var(--light);
        }
        
        .form-select, .form-input {
            padding: 10px;
            border-radius: 8px;
            border: 2px solid var(--accent);
            background: rgba(0, 0, 0, 0.2);
            color: white;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .action-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            flex-grow: 1;
            transition: all 0.2s;
        }
        
        .import-export-btn {
            background: var(--secondary);
            color: var(--dark);
        }
        
        .reset-btn {
            background: var(--primary);
            color: white;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        
        .controls-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }
        
        .pick-button {
            padding: 15px 40px;
            font-size: 1.5rem;
            background: linear-gradient(145deg, var(--primary), #ff0000);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(255, 0, 0, 0.3);
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 20px;
            width: 100%;
            max-width: 300px;
        }
        
        .pick-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 0, 0, 0.4);
        }
        
        .pick-button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 10px rgba(255, 0, 0, 0.4);
        }
        
        .result-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
            text-align: center;
        }
        
        .result-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: var(--secondary);
        }
        
        .winner-display {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            text-shadow: 0 0 10px var(--primary);
        }
        
        .history-list {
            list-style: none;
            text-align: left;
            width: 100%;
            margin-top: 10px;
            overflow-y: auto;
            max-height: 200px;
        }
        
        .history-item {
            padding: 8px 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
        }
        
        .history-item span {
            font-weight: bold;
            color: var(--secondary);
        }
        
        .remaining-display {
            margin-top: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            width: 100%;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: #212121;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            border: 2px solid var(--primary);
            position: relative;
        }
        
        .close-btn {
            position: absolute;
            right: 15px;
            top: 15px;
            font-size: 1.5rem;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
        }
        
        .modal-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--secondary);
        }
        
        .modal-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .modal-input, .modal-textarea {
            padding: 10px;
            border-radius: 8px;
            border: 2px solid var(--accent);
            background: rgba(0, 0, 0, 0.2);
            color: white;
            width: 100%;
        }
        
        .modal-textarea {
            min-height: 200px;
            font-family: monospace;
        }
        
        .modal-btn {
            padding: 10px 20px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
        }
        
        /* Selection animation and styles */
        .selection-indicator {
            position: absolute;
            left: 0;
            width: 100%;
            height: 48px; /* Adjust to match your list item height */
            background: rgba(255, 235, 59, 0.3);
            border-radius: 8px;
            box-shadow: 0 0 10px var(--secondary);
            z-index: -1;
            pointer-events: none;
            opacity: 0;
            transition: top 0.1s linear;
        }
        
        .selection-active .selection-indicator {
            opacity: 1;
        }
        
        .selected {
            transform: scale(1.02);
            background: rgba(255, 235, 59, 0.2) !important;
            border: 2px solid var(--secondary);
            z-index: 10;
        }
        
        .eliminated {
            text-decoration: line-through;
            opacity: 0.5;
            background: rgba(128, 0, 0, 0.3) !important;
        }
        
        .winner {
            background: rgba(0, 128, 0, 0.3) !important;
            border: 2px solid var(--winner);
            font-weight: bold;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
                gap: 10px;
            }
            
            .title {
                font-size: 2.5rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .pick-button {
                padding: 10px 25px;
                font-size: 1.2rem;
            }
        }
        
        /* Confetti container */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            pointer-events: none;
        }
        
        /* Selection animation */
        @keyframes selectionMove {
            0% {
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                opacity: 0;
            }
        }
        
        /* Winner animation */
        @keyframes celebrate {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }
        
        .celebrate {
            animation: celebrate 0.5s ease-in-out 3;
        }
        
        /* Speed control for selection animation */
        .speed-1 .selection-indicator { transition: top 0.08s linear; }
        .speed-2 .selection-indicator { transition: top 0.06s linear; }
        .speed-3 .selection-indicator { transition: top 0.04s linear; }
        .speed-4 .selection-indicator { transition: top 0.02s linear; }
        .speed-5 .selection-indicator { transition: top 0.01s linear; }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="title">Winner's List</h1>
        </header>
        
        <div class="panel">
            <h2 class="panel-title">Contestants</h2>
            <div class="name-list-container">
                <div class="selection-indicator"></div>
                <ul class="name-list" id="nameList">
                    <!-- Names will be populated here -->
                </ul>
            </div>
            <form class="add-name-form" id="addNameForm">
                <input type="text" class="name-input" id="nameInput" placeholder="Enter name..." required>
                <button type="submit" class="add-btn">Add</button>
            </form>
            
            <div class="controls-container">
                <button class="pick-button" id="pickButton">PICK</button>
                <div class="result-container">
                    <div class="result-title">Result</div>
                    <div class="winner-display" id="winnerDisplay">Click Pick to find out!</div>
                </div>
            </div>
        </div>
        
        <div class="panel">
            <h2 class="panel-title">Settings</h2>
            <form class="settings-form" id="settingsForm">
                <div class="form-group">
                    <label class="form-label">Game Mode</label>
                    <select class="form-select" id="gameMode">
                        <option value="first">First One Picked</option>
                        <option value="last">Last One Standing</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Selection Speed</label>
                    <input type="range" class="form-input" id="selectionSpeed" min="1" max="5" value="3" step="1">
                    <span id="speedValue">Medium</span>
                </div>
                <div class="form-group">
                    <label class="form-label">Selection Time (seconds)</label>
                    <input type="range" class="form-input" id="selectionDuration" min="1" max="10" value="3" step="0.5">
                    <span id="selectionDurationValue">3.0</span>
                </div>
                <div class="btn-group">
                    <button type="button" class="action-btn import-export-btn" id="importExportBtn">Import/Export</button>
                    <button type="button" class="action-btn reset-btn" id="resetBtn">Reset All</button>
                </div>
            </form>
            
            <div class="history-container">
                <h3 class="panel-title" style="margin-top: 20px">Results History</h3>
                <ul class="history-list" id="historyList">
                    <!-- History will be populated here -->
                </ul>
                <div class="remaining-display" id="remainingDisplay"></div>
            </div>
        </div>
    </div>
    
    <!-- Import/Export Modal -->
    <div class="modal" id="importExportModal">
        <div class="modal-content">
            <button class="close-btn" id="closeModal">&times;</button>
            <h3 class="modal-title">Import/Export Names</h3>
            <form class="modal-form" id="importExportForm">
                <p>Enter names (one per line) or copy the existing list:</p>
                <textarea class="modal-textarea" id="namesTextarea"></textarea>
                <button type="submit" class="modal-btn">Save Names</button>
            </form>
        </div>
    </div>
    
    <!-- Edit Name Modal -->
    <div class="modal" id="editNameModal">
        <div class="modal-content">
            <button class="close-btn" id="closeEditModal">&times;</button>
            <h3 class="modal-title">Edit Name</h3>
            <form class="modal-form" id="editNameForm">
                <input type="hidden" id="editNameIndex">
                <input type="text" class="modal-input" id="editNameInput" placeholder="Enter name..." required>
                <button type="submit" class="modal-btn">Update Name</button>
            </form>
        </div>
    </div>
    
    <!-- Confetti canvas -->
    <canvas id="confetti-canvas"></canvas>
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script>
        // Initialize variables
        let names = [];
        let originalNames = [];
        let winHistory = [];
        let isSelecting = false;
        let nameColorAssignments = {};
        let currentSelectionIndex = 0;
        let selectionInterval = null;
        
        // DOM Elements
        const nameList = document.getElementById('nameList');
        const selectionIndicator = document.querySelector('.selection-indicator');
        const pickButton = document.getElementById('pickButton');
        const addNameForm = document.getElementById('addNameForm');
        const nameInput = document.getElementById('nameInput');
        const winnerDisplay = document.getElementById('winnerDisplay');
        const historyList = document.getElementById('historyList');
        const remainingDisplay = document.getElementById('remainingDisplay');
        const importExportBtn = document.getElementById('importExportBtn');
        const resetBtn = document.getElementById('resetBtn');
        const importExportModal = document.getElementById('importExportModal');
        const closeModal = document.getElementById('closeModal');
        const namesTextarea = document.getElementById('namesTextarea');
        const importExportForm = document.getElementById('importExportForm');
        const editNameModal = document.getElementById('editNameModal');
        const closeEditModal = document.getElementById('closeEditModal');
        const editNameForm = document.getElementById('editNameForm');
        const editNameInput = document.getElementById('editNameInput');
        const editNameIndex = document.getElementById('editNameIndex');
        const gameMode = document.getElementById('gameMode');
        const selectionSpeed = document.getElementById('selectionSpeed');
        const speedValue = document.getElementById('speedValue');
        const selectionDuration = document.getElementById('selectionDuration');
        const selectionDurationValue = document.getElementById('selectionDurationValue');
        
        // Colors for name items
        const colors = [
            '#FF5252', '#FF4081', '#E040FB', '#7C4DFF', 
            '#536DFE', '#448AFF', '#40C4FF', '#18FFFF', 
            '#64FFDA', '#69F0AE', '#B2FF59', '#EEFF41', 
            '#FFFF00', '#FFD740', '#FFAB40', '#FF6E40'
        ];
        
        // Initialize the app
        function init() {
            // Load saved names from localStorage
            loadNames();
            
            // Add event listeners
            addNameForm.addEventListener('submit', addName);
            pickButton.addEventListener('click', startSelection);
            importExportBtn.addEventListener('click', openImportExportModal);
            closeModal.addEventListener('click', closeImportExportModal);
            importExportForm.addEventListener('submit', saveImportedNames);
            resetBtn.addEventListener('click', resetAll);
            closeEditModal.addEventListener('click', closeEditNameModal);
            editNameForm.addEventListener('submit', updateName);
            gameMode.addEventListener('change', handleGameModeChange);
            selectionSpeed.addEventListener('input', updateSpeedDisplay);
            selectionDuration.addEventListener('input', updateSelectionDurationDisplay);
            
            // Initialize the selection container
            document.querySelector('.name-list-container').classList.add(`speed-${selectionSpeed.value}`);
            
            // Update the display initially
            updateRemainingDisplay();
        }
        
        // Load names from localStorage
        function loadNames() {
            const savedNames = localStorage.getItem('winnerListNames');
            names = savedNames ? JSON.parse(savedNames) : [];
            originalNames = [...names];
            
            // Load saved color assignments
            const savedColorAssignments = localStorage.getItem('winnerListColorAssignments');
            nameColorAssignments = savedColorAssignments ? JSON.parse(savedColorAssignments) : {};
            
            // Assign colors to names that don't have one yet
            names.forEach(name => assignColorToName(name));
            
            updateNameList();
        }
        
        // Save names to localStorage
        function saveNames() {
            localStorage.setItem('winnerListNames', JSON.stringify(names));
            localStorage.setItem('winnerListColorAssignments', JSON.stringify(nameColorAssignments));
            originalNames = [...names];
        }
        
        // Add a new name
        function addName(e) {
            e.preventDefault();
            const name = nameInput.value.trim();
            
            if (name && !names.includes(name)) {
                // Assign color FIRST before adding the name
                assignColorToName(name);
                
                names.push(name);
                saveNames();
                updateNameList();
                nameInput.value = '';
            } else if (names.includes(name)) {
                alert('This name already exists!');
            }
        }
        
        // Deterministically assign a color to a name
        function assignColorToName(name) {
            // If the name doesn't have a color yet, assign one
            if (!nameColorAssignments[name]) {
                // Use the name's string value to deterministically assign a color index
                let nameHash = 0;
                for (let i = 0; i < name.length; i++) {
                    nameHash = ((nameHash << 5) - nameHash) + name.charCodeAt(i);
                    nameHash = nameHash & nameHash; // Convert to 32bit integer
                }
                const colorIndex = Math.abs(nameHash) % colors.length;
                nameColorAssignments[name] = colors[colorIndex];
            }
            return nameColorAssignments[name];
        }
        
        // Edit a name
        function editName(index) {
            editNameIndex.value = index;
            editNameInput.value = names[index];
            editNameModal.style.display = 'flex';
        }
        
        // Update a name
        function updateName(e) {
            e.preventDefault();
            const index = parseInt(editNameIndex.value);
            const oldName = names[index];
            const newName = editNameInput.value.trim();
            
            if (newName && !names.includes(newName)) {
                // Preserve the color assignment
                nameColorAssignments[newName] = nameColorAssignments[oldName];
                delete nameColorAssignments[oldName]; // Remove the old name's color
                
                names[index] = newName;
                saveNames();
                updateNameList();
                closeEditNameModal();
            } else if (names.includes(newName) && names[index] !== newName) {
                alert('This name already exists!');
            } else {
                closeEditNameModal();
            }
        }
        
        // Close the edit name modal
        function closeEditNameModal() {
            editNameModal.style.display = 'none';
        }
        
        // Delete a name
        function deleteName(index) {
            const nameToDelete = names[index];
            
            // Remove the color assignment when completely deleting from game
            delete nameColorAssignments[nameToDelete];
            
            names.splice(index, 1);
            saveNames();
            updateNameList();
        }
        
        // Update the name list UI
        function updateNameList() {
            nameList.innerHTML = '';
            
            names.forEach((name, index) => {
                const li = document.createElement('li');
                li.className = 'name-item';
                li.setAttribute('data-index', index);
                
                // Use the stored color assignment for background
                li.style.backgroundColor = nameColorAssignments[name];
                li.style.color = 'white';
                li.style.textShadow = '1px 1px 2px black';
                
                const nameText = document.createElement('span');
                nameText.className = 'name-text';
                nameText.style.overflow = 'hidden';
                nameText.style.textOverflow = 'ellipsis';
                nameText.style.whiteSpace = 'nowrap';
                nameText.style.maxWidth = 'calc(100% - 110px)';
                nameText.textContent = name;
                nameText.title = name;
                
                const editBtn = document.createElement('button');
                editBtn.className = 'edit-btn';
                editBtn.textContent = 'Edit';
                editBtn.addEventListener('click', () => editName(index));
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.textContent = 'Delete';
                deleteBtn.addEventListener('click', () => deleteName(index));
                
                li.appendChild(nameText);
                li.appendChild(editBtn);
                li.appendChild(deleteBtn);
                
                nameList.appendChild(li);
            });
            
            // Update selection indicator height based on list item height
            if (names.length > 0) {
                const firstItem = nameList.querySelector('.name-item');
                if (firstItem) {
                    const itemHeight = firstItem.offsetHeight;
                    selectionIndicator.style.height = `${itemHeight}px`;
                }
            }
            
            updateRemainingDisplay();
        }
        
        // Start the selection animation
        function startSelection() {
            if (isSelecting || names.length === 0) return;
            
            isSelecting = true;
            pickButton.disabled = true;
            
            // Reset any previous selections
            resetSelectionStates();
            
            // Activate selection mode
            document.querySelector('.name-list-container').classList.add('selection-active');
            
            // Start with a random position
            currentSelectionIndex = Math.floor(Math.random() * names.length);
            
            // Calculate selection parameters
            const speed = 6 - parseInt(selectionSpeed.value); // Invert so higher = faster
            const duration = parseFloat(selectionDuration.value) * 1000; // Convert to milliseconds
            
            // Start the selection animation
            moveSelectionIndicator();
            
            // Set interval to move the indicator
            selectionInterval = setInterval(moveSelectionIndicator, speed * 25);
            
            // Schedule end of selection
            setTimeout(finishSelection, duration);
        }
        
        // Move the selection indicator
        function moveSelectionIndicator() {
            // Clear previous selection
            const items = nameList.querySelectorAll('.name-item');
            items.forEach(item => item.classList.remove('selected'));
            
            // Move to next index (loop around if needed)
            currentSelectionIndex = (currentSelectionIndex + 1) % names.length;
            
            // Get the current item
            const currentItem = items[currentSelectionIndex];
            
            if (currentItem) {
                // Calculate position and move indicator
                const topPosition = currentItem.offsetTop;
                selectionIndicator.style.top = `${topPosition}px`;
                
                // Add selected class to current item
                currentItem.classList.add('selected');
            }
        }
        
        // Finish the selection process
        function finishSelection() {
            // Clear the selection interval
            clearInterval(selectionInterval);
            
            // Get the selected name
            const selectedName = names[currentSelectionIndex];
            
            // Stop the animation
            document.querySelector('.name-list-container').classList.remove('selection-active');
            
            // Handle the selection based on game mode
            if (gameMode.value === 'first') {
                handleFirstOnePicked(selectedName, currentSelectionIndex);
            } else {
                handleLastManStanding(selectedName, currentSelectionIndex);
            }
            
            // Reset state
            isSelecting = false;
            pickButton.disabled = false;
        }
        
        // Handle first one picked mode
        function handleFirstOnePicked(selectedName, index) {
            // Display the winner
            winnerDisplay.textContent = selectedName;
            winnerDisplay.style.color = 'var(--winner)';
            winnerDisplay.classList.add('celebrate');
            
            // Highlight the winner in the list
            const items = nameList.querySelectorAll('.name-item');
            items[index].classList.add('winner');
            
            // Launch confetti
            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 }
            });
            
            // Add to history
            winHistory.unshift(selectedName);
            updateHistoryList();
            
            // Remove celebration class after animation completes
            setTimeout(() => {
                winnerDisplay.classList.remove('celebrate');
            }, 1500);
        }
        
        // Handle last man standing mode
        function handleLastManStanding(selectedName, index) {
            // Show who's been eliminated
            winnerDisplay.textContent = `${selectedName} ELIMINATED!`;
            winnerDisplay.style.color = 'var(--eliminated)';
            
            // Add to history as an elimination
            winHistory.unshift(`${selectedName} (Eliminated)`);
            updateHistoryList();
            
            // Mark as eliminated in the list
            const items = nameList.querySelectorAll('.name-item');
            items[index].classList.add('eliminated');
            
            // Check if this is the second-to-last contestant
            if (names.length === 2) {
                // Find who will be the winner (the one not being eliminated)
                const finalWinnerIndex = index === 0 ? 1 : 0;
                const finalWinner = names[finalWinnerIndex];
                
                // Remove the eliminated person
                names.splice(index, 1);
                
                // Update the list after a short delay
                setTimeout(() => {
                    updateNameList();
                    
                    // Highlight the final winner
                    const updatedItems = nameList.querySelectorAll('.name-item');
                    updatedItems[0].classList.add('winner');
                    
                    // Announce the final winner
                    winnerDisplay.textContent = `${finalWinner} WINS!`;
                    winnerDisplay.style.color = 'var(--winner)';
                    winnerDisplay.classList.add('celebrate');
                    
                    // Launch confetti for the winner
                    confetti({
                        particleCount: 150,
                        spread: 70,
                        origin: { y: 0.6 }
                    });
                    
                    // Add the winner to history
                    winHistory.unshift(`${finalWinner} (WINNER!)`);
                    updateHistoryList();
                    
                    // Reset the game after another delay
                    setTimeout(() => {
                        alert(`${finalWinner} is the last one standing and wins!`);
                        resetToOriginalNames();
                    }, 3000);
                }, 1000);
            } else {
                // Normal elimination for non-final rounds
                names.splice(index, 1);
                
                // Update the list after a short delay
                setTimeout(() => {
                    updateNameList();
                    
                    // Check if all contestants have been eliminated
                    if (names.length === 0) {
                        setTimeout(() => {
                            alert('Game over! All contestants have been eliminated.');
                            resetToOriginalNames();
                        }, 1000);
                    }
                }, 1000);
            }
        }
        
        // Reset selection states
        function resetSelectionStates() {
            const items = nameList.querySelectorAll('.name-item');
            items.forEach(item => {
                item.classList.remove('selected');
                item.classList.remove('winner');
            });
        }
        
        // Reset to original names
        function resetToOriginalNames() {
            names = [...originalNames];
            updateNameList();
            winnerDisplay.style.color = 'var(--primary)';
            winnerDisplay.textContent = 'Click Pick to find out!';
        }
        
        // Handle game mode change
        function handleGameModeChange() {
            if (gameMode.value === 'first') {
                // Restore original names if switching from last man standing
                resetToOriginalNames();
            } else if (gameMode.value === 'last') {
                // Reset history when starting last man standing
                winHistory = [];
                updateHistoryList();
            }
            
            updateRemainingDisplay();
        }
        
        // Update history list
        function updateHistoryList() {
            historyList.innerHTML = '';
            
            // Add each history item to the list (show up to 10 most recent)
            const historyToShow = winHistory.slice(0, 10);
            
            historyToShow.forEach((item, index) => {
                const li = document.createElement('li');
                li.className = 'history-item';
                
                // Check if this is a winner or eliminated entry
                if (item.includes('WINNER') || item.includes('WIN')) {
                    li.innerHTML = `#${index + 1}: <span style="color: var(--winner)">${item}</span>`;
                } else if (item.includes('Eliminated')) {
                    li.innerHTML = `#${index + 1}: <span style="color: var(--eliminated)">${item}</span>`;
                } else {
                    li.innerHTML = `#${index + 1}: <span>${item}</span>`;
                }
                
                historyList.appendChild(li);
            });
        }
        
        // Update remaining display based on game mode
        function updateRemainingDisplay() {
            if (gameMode.value === 'last') {
                remainingDisplay.innerHTML = `<strong>Remaining:</strong> ${names.length} contestants`;
                remainingDisplay.style.display = 'block';
            } else {
                remainingDisplay.style.display = 'none';
            }
        }
        
        // Update the speed display
        function updateSpeedDisplay() {
            const speedLabels = ['Very Slow', 'Slow', 'Medium', 'Fast', 'Very Fast'];
            speedValue.textContent = speedLabels[parseInt(selectionSpeed.value) - 1];
            
            // Update speed class on container
            const container = document.querySelector('.name-list-container');
            container.className = 'name-list-container';
            container.classList.add(`speed-${selectionSpeed.value}`);
            if (isSelecting) {
                container.classList.add('selection-active');
            }
        }
        
        // Update selection duration display
        function updateSelectionDurationDisplay() {
            selectionDurationValue.textContent = selectionDuration.value;
        }
        
        // Open the import/export modal
        function openImportExportModal() {
            namesTextarea.value = names.join('\n');
            importExportModal.style.display = 'flex';
        }
        
        // Close the import/export modal
        function closeImportExportModal() {
            importExportModal.style.display = 'none';
        }
        
        // Save imported names
        function saveImportedNames(e) {
            e.preventDefault();
            const importedText = namesTextarea.value.trim();
            
            if (importedText) {
                // Split by new lines and filter empty lines
                const newNames = importedText
                    .split('\n')
                    .map(name => name.trim())
                    .filter(name => name.length > 0);
                
                // Deduplicate names
                const uniqueNames = [...new Set(newNames)];
                
                names = uniqueNames;
                
                // Assign colors to new names
                names.forEach(name => assignColorToName(name));
                
                saveNames();
                updateNameList();
            }
            
            closeImportExportModal();
        }
        
        // Reset all data
        function resetAll() {
            if (confirm('Are you sure you want to reset all data? This cannot be undone.')) {
                names = [];
                originalNames = [];
                winHistory = [];
                nameColorAssignments = {}; // Clear color assignments
                
                // Save the reset state
                localStorage.removeItem('winnerListNames');
                localStorage.removeItem('winnerListColorAssignments');
                
                updateNameList();
                winnerDisplay.textContent = 'Click Pick to find out!';
                winnerDisplay.style.color = 'var(--primary)';
                
                updateRemainingDisplay();
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>