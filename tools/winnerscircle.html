<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Winner's Circle</title>
    <style>
        :root {
            --primary: #ff5252;
            --secondary: #ffeb3b;
            --accent: #2196f3;
            --dark: #212121;
            --light: #f5f5f5;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial Rounded MT Bold', 'Helvetica Rounded', Arial, sans-serif;
        }
        
        body {
            background-color: #121212;
            color: white;
            background-image: radial-gradient(circle, #303030 1px, transparent 1px);
            background-size: 20px 20px;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            height: calc(100vh - 40px);
        }
        
        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
                height: auto;
            }
        }
        
        .header {
            grid-column: 1 / -1;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .title {
            font-size: 4rem;
            margin: 10px 0;
            color: var(--secondary);
            text-shadow: 
                0 0 5px var(--primary),
                0 0 10px var(--primary),
                0 0 15px var(--primary);
            animation: flicker 3s infinite alternate;
        }
        
        @keyframes flicker {
            0%, 18%, 22%, 25%, 53%, 57%, 100% {
                text-shadow: 
                    0 0 5px var(--primary),
                    0 0 10px var(--primary),
                    0 0 15px var(--primary);
            }
            20%, 24%, 55% {
                text-shadow: none;
            }
        }
        
        .subtitle {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--light);
        }
        
        .panel {
            background: rgba(20, 20, 20, 0.8);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            border: 2px solid var(--primary);
            position: relative;
            overflow: hidden;
        }
        
        .panel::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-conic-gradient(
                transparent 0deg 10deg,
                rgba(255, 82, 82, 0.1) 10deg 20deg
            );
            animation: rotate 120s linear infinite;
            z-index: -1;
        }
        
        @keyframes rotate {
            100% {
                transform: rotate(360deg);
            }
        }
        
        .panel-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            text-align: center;
            color: var(--secondary);
        }
        
        .wheel-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            height: 100%;
        }
        
        .wheel-wrapper {
            position: relative;
            width: 100%;
            max-width: 500px;
            aspect-ratio: 1 / 1;
        }
        
        .wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            transition: transform 5s cubic-bezier(0.2, 0.8, 0.15, 1);
            box-shadow: 
                0 0 0 5px white,
                0 0 0 10px var(--primary),
                0 5px 20px rgba(0,0,0,0.5);
        }
        
        .wheel-center {
            position: absolute;
            width: 50px;
            height: 50px;
            background: radial-gradient(circle at center, white, silver);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            border: 3px solid #333;
        }
        
        .ticker {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 50px;
            z-index: 5;
        }
        
        .ticker::before {
            content: '';
            position: absolute;
            width: 30px;
            height: 30px;
            background-color: var(--accent);
            clip-path: polygon(50% 100%, 0 0, 100% 0);
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        
        .spin-button {
            margin-top: 30px;
            padding: 15px 40px;
            font-size: 1.5rem;
            background: linear-gradient(145deg, var(--primary), #ff0000);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(255, 0, 0, 0.3);
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .spin-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 0, 0, 0.4);
        }
        
        .spin-button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 10px rgba(255, 0, 0, 0.4);
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: var(--primary);
            opacity: 0;
            z-index: 100;
        }
        
        .name-list {
            list-style: none;
            overflow-y: auto;
            flex-grow: 1;
            margin-bottom: 15px;
        }
        
        .name-item {
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            margin-bottom: 8px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }
        
        .name-item:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .name-text {
            flex-grow: 1;
            margin-right: 10px;
        }
        
        .edit-btn, .delete-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 5px;
        }
        
        .edit-btn {
            background-color: var(--accent);
            color: white;
        }
        
        .delete-btn {
            background-color: var(--primary);
            color: white;
        }
        
        .add-name-form {
            display: flex;
            margin-top: auto;
        }
        
        .name-input {
            flex-grow: 1;
            padding: 10px 15px;
            border: 2px solid var(--accent);
            border-radius: 8px 0 0 8px;
            font-size: 1rem;
            background: rgba(0, 0, 0, 0.2);
            color: white;
        }
        
        .add-btn {
            padding: 10px 20px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 0 8px 8px 0;
            cursor: pointer;
            font-weight: bold;
        }
        
        .settings-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .form-label {
            font-size: 1rem;
            color: var(--light);
        }
        
        .form-select, .form-input {
            padding: 10px;
            border-radius: 8px;
            border: 2px solid var(--accent);
            background: rgba(0, 0, 0, 0.2);
            color: white;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .action-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            flex-grow: 1;
            transition: all 0.2s;
        }
        
        .import-export-btn {
            background: var(--secondary);
            color: var(--dark);
        }
        
        .reset-btn {
            background: var(--primary);
            color: white;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        
        .result-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
            text-align: center;
        }
        
        .result-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: var(--secondary);
        }
        
        .winner-display {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            text-shadow: 0 0 10px var(--primary);
        }
        
        .history-list {
            list-style: none;
            text-align: left;
            width: 100%;
            margin-top: 10px;
            overflow-y: auto;
            max-height: 200px;
        }
        
        .history-item {
            padding: 8px 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
        }
        
        .history-item span {
            font-weight: bold;
            color: var(--secondary);
        }
        
        .remaining-display {
            margin-top: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            width: 100%;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: #212121;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            border: 2px solid var(--primary);
            position: relative;
        }
        
        .close-btn {
            position: absolute;
            right: 15px;
            top: 15px;
            font-size: 1.5rem;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
        }
        
        .modal-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--secondary);
        }
        
        .modal-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .modal-input, .modal-textarea {
            padding: 10px;
            border-radius: 8px;
            border: 2px solid var(--accent);
            background: rgba(0, 0, 0, 0.2);
            color: white;
            width: 100%;
        }
        
        .modal-textarea {
            min-height: 200px;
            font-family: monospace;
        }
        
        .modal-btn {
            padding: 10px 20px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
                gap: 10px;
            }
            
            .title {
                font-size: 2.5rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .wheel-wrapper {
                max-width: 300px;
            }
            
            .spin-button {
                padding: 10px 25px;
                font-size: 1.2rem;
            }
        }
        
        /* Winner animation */
        @keyframes celebrate {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }
        
        .celebrate {
            animation: celebrate 0.5s ease-in-out 3;
        }
        
        /* Last standing animation */
        .eliminated {
            text-decoration: line-through;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="title">Winner's Circle</h1>
        </header>
        
        <div class="panel">
            <h2 class="panel-title">Contestants</h2>
            <ul class="name-list" id="nameList">
                <!-- Names will be populated here -->
            </ul>
            <form class="add-name-form" id="addNameForm">
                <input type="text" class="name-input" id="nameInput" placeholder="Enter name..." required>
                <button type="submit" class="add-btn">Add</button>
            </form>
        </div>
        
        <div class="panel wheel-container">
            <div class="wheel-wrapper">
                <div class="ticker"></div>
                <div class="wheel" id="wheel">
                    <!-- Wheel sections will be populated here -->
                </div>
                <div class="wheel-center"></div>
            </div>
            <button class="spin-button" id="spinButton">SPIN</button>
            <div class="result-container">
                <div class="result-title">Winner</div>
                <div class="winner-display" id="winnerDisplay">Spin to find out!</div>
            </div>
        </div>
        
        <div class="panel">
            <h2 class="panel-title">Settings</h2>
            <form class="settings-form" id="settingsForm">
                <div class="form-group">
                    <label class="form-label">Game Mode</label>
                    <select class="form-select" id="gameMode">
                        <option value="first">First One Picked</option>
                        <option value="last">Last Man Standing</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Name Duplications</label>
                    <select class="form-select" id="duplicationMode">
                        <option value="1">No Duplication</option>
                        <option value="2">Double Names</option>
                        <option value="3">Triple Names</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Spin Time (seconds)</label>
                    <input type="range" class="form-input" id="spinDuration" min="2" max="10" value="5" step="0.5">
                    <span id="spinDurationValue">5.0</span>
                </div>
                <div class="btn-group">
                    <button type="button" class="action-btn import-export-btn" id="importExportBtn">Import/Export</button>
                    <button type="button" class="action-btn reset-btn" id="resetBtn">Reset All</button>
                </div>
            </form>
            
            <div class="history-container">
                <h3 class="panel-title" style="margin-top: 20px">Results History</h3>
                <ul class="history-list" id="historyList">
                    <!-- History will be populated here -->
                </ul>
                <div class="remaining-display" id="remainingDisplay"></div>
            </div>
        </div>
    </div>
    
    <!-- Import/Export Modal -->
    <div class="modal" id="importExportModal">
        <div class="modal-content">
            <button class="close-btn" id="closeModal">&times;</button>
            <h3 class="modal-title">Import/Export Names</h3>
            <form class="modal-form" id="importExportForm">
                <p>Enter names (one per line) or copy the existing list:</p>
                <textarea class="modal-textarea" id="namesTextarea"></textarea>
                <button type="submit" class="modal-btn">Save Names</button>
            </form>
        </div>
    </div>
    
    <!-- Edit Name Modal -->
    <div class="modal" id="editNameModal">
        <div class="modal-content">
            <button class="close-btn" id="closeEditModal">&times;</button>
            <h3 class="modal-title">Edit Name</h3>
            <form class="modal-form" id="editNameForm">
                <input type="hidden" id="editNameIndex">
                <input type="text" class="modal-input" id="editNameInput" placeholder="Enter name..." required>
                <button type="submit" class="modal-btn">Update Name</button>
            </form>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script>
        // Initialize variables
        let names = [];
        let originalNames = [];
        let currentNames = [];
        let winHistory = [];
        let isSpinning = false;
        let canvasConfetti = null;
        
        // DOM Elements
        const wheel = document.getElementById('wheel');
        const spinButton = document.getElementById('spinButton');
        const nameList = document.getElementById('nameList');
        const addNameForm = document.getElementById('addNameForm');
        const nameInput = document.getElementById('nameInput');
        const winnerDisplay = document.getElementById('winnerDisplay');
        const historyList = document.getElementById('historyList');
        const remainingDisplay = document.getElementById('remainingDisplay');
        const importExportBtn = document.getElementById('importExportBtn');
        const resetBtn = document.getElementById('resetBtn');
        const importExportModal = document.getElementById('importExportModal');
        const closeModal = document.getElementById('closeModal');
        const namesTextarea = document.getElementById('namesTextarea');
        const importExportForm = document.getElementById('importExportForm');
        const editNameModal = document.getElementById('editNameModal');
        const closeEditModal = document.getElementById('closeEditModal');
        const editNameForm = document.getElementById('editNameForm');
        const editNameInput = document.getElementById('editNameInput');
        const editNameIndex = document.getElementById('editNameIndex');
        const gameMode = document.getElementById('gameMode');
        const duplicationMode = document.getElementById('duplicationMode');
        const spinDuration = document.getElementById('spinDuration');
        const spinDurationValue = document.getElementById('spinDurationValue');
        
        // Colors for wheel sections
        const colors = [
            '#FF5252', '#FF4081', '#E040FB', '#7C4DFF', 
            '#536DFE', '#448AFF', '#40C4FF', '#18FFFF', 
            '#64FFDA', '#69F0AE', '#B2FF59', '#EEFF41', 
            '#FFFF00', '#FFD740', '#FFAB40', '#FF6E40'
        ];
        
        // Initialize the app
		function init() {
			// Load saved names from localStorage
			loadNames();
			
			// Add event listeners
			addNameForm.addEventListener('submit', addName);
			spinButton.addEventListener('click', spinWheel);
			importExportBtn.addEventListener('click', openImportExportModal);
			closeModal.addEventListener('click', closeImportExportModal);
			importExportForm.addEventListener('submit', saveImportedNames);
			resetBtn.addEventListener('click', resetAll);
			closeEditModal.addEventListener('click', closeEditNameModal);
			editNameForm.addEventListener('submit', updateName);
			gameMode.addEventListener('change', handleGameModeChange);
			duplicationMode.addEventListener('change', updateWheel);
			spinDuration.addEventListener('input', updateSpinDurationDisplay);
			
			// No complex confetti setup needed
			canvasConfetti = confetti;
			
			// Update the wheel initially
			updateWheel();
		}
        
        // Load names from localStorage
        function loadNames() {
            const savedNames = localStorage.getItem('winnerCircleNames');
            names = savedNames ? JSON.parse(savedNames) : [];
            originalNames = [...names];
            currentNames = [...names];
            updateNameList();
        }
        
        // Save names to localStorage
        function saveNames() {
            localStorage.setItem('winnerCircleNames', JSON.stringify(names));
            originalNames = [...names];
        }
        
        // Add a new name
        function addName(e) {
            e.preventDefault();
            const name = nameInput.value.trim();
            
            if (name && !names.includes(name)) {
                names.push(name);
                saveNames();
                updateNameList();
                updateWheel();
                nameInput.value = '';
            } else if (names.includes(name)) {
                alert('This name already exists!');
            }
        }
        
        // Edit a name
        function editName(index) {
            editNameIndex.value = index;
            editNameInput.value = names[index];
            editNameModal.style.display = 'flex';
        }
        
        // Update a name
        function updateName(e) {
            e.preventDefault();
            const index = parseInt(editNameIndex.value);
            const newName = editNameInput.value.trim();
            
            if (newName && !names.includes(newName)) {
                names[index] = newName;
                saveNames();
                updateNameList();
                updateWheel();
                closeEditNameModal();
            } else if (names.includes(newName) && names[index] !== newName) {
                alert('This name already exists!');
            } else {
                closeEditNameModal();
            }
        }
        
        // Close the edit name modal
        function closeEditNameModal() {
            editNameModal.style.display = 'none';
        }
        
        // Delete a name
        function deleteName(index) {
            names.splice(index, 1);
            saveNames();
            updateNameList();
            updateWheel();
        }
        
        // Update the name list UI
		function updateNameList() {
			nameList.innerHTML = '';
			
			names.forEach((name, index) => {
				const li = document.createElement('li');
				li.className = 'name-item';
				li.style.backgroundColor = colors[index % colors.length];
				li.style.color = 'white';
				li.style.textShadow = '1px 1px 2px black';
				
				const nameText = document.createElement('span');
				nameText.className = 'name-text';
				nameText.textContent = name;
				
				const editBtn = document.createElement('button');
				editBtn.className = 'edit-btn';
				editBtn.textContent = 'Edit';
				editBtn.addEventListener('click', () => editName(index));
				
				const deleteBtn = document.createElement('button');
				deleteBtn.className = 'delete-btn';
				deleteBtn.textContent = 'Delete';
				deleteBtn.addEventListener('click', () => deleteName(index));
				
				li.appendChild(nameText);
				li.appendChild(editBtn);
				li.appendChild(deleteBtn);
				
				nameList.appendChild(li);
			});
			
			updateRemainingDisplay();
		}
        
		// Update the wheel UI
		function updateWheel() {
			wheel.innerHTML = '';
			
			if (names.length === 0) {
				wheel.style.backgroundColor = '#333';
				return;
			}
			
			// Create a duplicate array based on duplication settings
			const duplication = parseInt(duplicationMode.value);
			currentNames = [];
			
			for (let i = 0; i < duplication; i++) {
				currentNames.push(...names);
			}
			
			// Shuffle the names if duplicated
			if (duplication > 1) {
				shuffleArray(currentNames);
			}
			
			const sectionAngle = 360 / currentNames.length;
			
			// First, apply overflow hidden to the wheel to ensure circular shape
			wheel.style.overflow = 'hidden';
			wheel.style.borderRadius = '50%';
			wheel.style.position = 'relative';
			
			// Create wheel sections using the conic-gradient background
			if (currentNames.length > 0) {
				let conicGradientStops = [];
				
				for (let i = 0; i < currentNames.length; i++) {
					const startAngle = i * sectionAngle;
					const endAngle = (i + 1) * sectionAngle;
					const color = colors[i % colors.length];
					
					conicGradientStops.push(`${color} ${startAngle}deg ${endAngle}deg`);
				}
				
				wheel.style.background = `conic-gradient(${conicGradientStops.join(', ')})`;
			}
			
			// Add divider lines
			for (let i = 0; i < currentNames.length; i++) {
				const divider = document.createElement('div');
				divider.className = 'wheel-divider';
				divider.style.position = 'absolute';
				divider.style.width = '50%';
				divider.style.height = '2px';
				divider.style.backgroundColor = 'rgba(0, 0, 0, 0.3)';
				divider.style.top = '50%';
				divider.style.left = '50%';
				divider.style.transformOrigin = 'left center';
				divider.style.transform = `rotate(${i * sectionAngle}deg)`;
				divider.style.zIndex = '2';
				wheel.appendChild(divider);
			}
			
			// Add name labels as spokes radiating from center
			for (let i = 0; i < currentNames.length; i++) {
				const name = currentNames[i];
				
				// Calculate middle angle of the section
				const midAngle = i * sectionAngle + (sectionAngle / 2);
				const midRad = (midAngle - 90) * Math.PI / 180; // Convert to radians and adjust for CSS rotation
				
				// Create a container for the entire name
				const spokeLine = document.createElement('div');
				spokeLine.className = 'wheel-spoke';
				spokeLine.style.position = 'absolute';
				spokeLine.style.left = '50%';
				spokeLine.style.top = '50%';
				spokeLine.style.width = '40%'; // Length of the spoke from center
				spokeLine.style.height = '2px';
				spokeLine.style.backgroundColor = 'rgba(255,255,255,0.5)';
				spokeLine.style.transformOrigin = 'left center';
				spokeLine.style.transform = `rotate(${midAngle}deg)`;
				spokeLine.style.zIndex = '3';
				wheel.appendChild(spokeLine);
				
				// Create text container
				const nameContainer = document.createElement('div');
				nameContainer.className = 'wheel-name';
				nameContainer.style.position = 'absolute';
				nameContainer.style.left = '50%';
				nameContainer.style.top = '50%';
				nameContainer.style.transformOrigin = 'left center';
				nameContainer.style.transform = `rotate(${midAngle}deg)`;
				nameContainer.style.zIndex = '4';
				
				// Create the text element for the name
				const nameText = document.createElement('div');
				nameText.textContent = name;
				nameText.style.position = 'absolute';
				nameText.style.whiteSpace = 'nowrap';
				nameText.style.fontWeight = 'bold';
				nameText.style.color = 'white';
				nameText.style.textShadow = '1px 1px 3px rgba(0,0,0,0.9), -1px -1px 3px rgba(0,0,0,0.9)';
				
				// Adjust font size based on number of contestants
				nameText.style.fontSize = currentNames.length > 20 ? '11px' : 
										 currentNames.length > 12 ? '13px' : 
										 currentNames.length > 6 ? '15px' : '16px';
				
				// Position text at 30% from center, rotated to be readable
				nameText.style.left = '30%';
				nameText.style.top = '0';
				nameText.style.transform = `translate(0, -50%) rotate(90deg)`;
				nameText.style.transformOrigin = 'left center';
				
				nameContainer.appendChild(nameText);
				wheel.appendChild(nameContainer);
			}
			
			// Add a border to ensure the wheel looks circular
			wheel.style.border = '3px solid white';
			wheel.style.boxShadow = '0 0 0 2px #ff5252';
		}

		// Spin the wheel
		function spinWheel() {
			if (isSpinning || currentNames.length === 0) return;
			
			isSpinning = true;
			spinButton.disabled = true;
			
			// Calculate a random rotation (between 2 and 5 full rotations plus a random section)
			const spinDurationValue = parseFloat(spinDuration.value);
			const sectionAngle = 360 / currentNames.length;
			const spinAngle = 720 + Math.floor(Math.random() * 1080) + Math.floor(Math.random() * sectionAngle);
			
			// Apply the rotation
			wheel.style.transition = `transform ${spinDurationValue}s cubic-bezier(0.2, 0.8, 0.15, 1)`;
			wheel.style.transform = `rotate(${spinAngle}deg)`;
			
			// Calculate the winner after the spin
			setTimeout(() => {
				// Calculate which section is at the top (opposite of rotation angle)
				const normalizedAngle = spinAngle % 360;
				const winningIndex = Math.floor(currentNames.length - (normalizedAngle / sectionAngle)) % currentNames.length;
				const winner = currentNames[winningIndex];
				
				// Update the display
				winnerDisplay.textContent = winner;
				winnerDisplay.classList.add('celebrate');
				
				// Launch confetti
				confetti({
					particleCount: 150,
					spread: 70,
					origin: { y: 0.6 }
				});
				
				// Add to history
				addToHistory(winner);
				
				// Handle game modes
				if (gameMode.value === 'last') {
					handleLastManStanding(winner);
				}
				
				// Reset state
				isSpinning = false;
				spinButton.disabled = false;
				
				// Remove celebration class after animation
				setTimeout(() => {
					winnerDisplay.classList.remove('celebrate');
				}, 1500);
			}, spinDurationValue * 1000);
		}

		// Add winner to history
		function addToHistory(winner) {
			winHistory.unshift(winner);
			
			// Keep history at a maximum of 10 items
			if (winHistory.length > 10) {
				winHistory.pop();
			}
			
			// Update history list
			updateHistoryList();
		}

		// Update the history list UI
		function updateHistoryList() {
			historyList.innerHTML = '';
			
			winHistory.forEach((winner, index) => {
				const li = document.createElement('li');
				li.className = 'history-item';
				li.innerHTML = `Round ${winHistory.length - index}: <span>${winner}</span>`;
				historyList.appendChild(li);
			});
		}

		// Handle last man standing game mode
		function handleLastManStanding(winner) {
			const index = names.indexOf(winner);
			
			if (index !== -1) {
				names.splice(index, 1);
				updateNameList();
				updateWheel();
				
				// Check if there's only one name left
				if (names.length === 1) {
					// Final winner
					setTimeout(() => {
						alert(`${names[0]} is the last one standing and wins!`);
						// Reset the game
						names = [...originalNames];
						updateNameList();
						updateWheel();
					}, 1000);
				} else if (names.length === 0) {
					// All eliminated
					setTimeout(() => {
						alert('Game over! All contestants have been eliminated.');
						// Reset the game
						names = [...originalNames];
						updateNameList();
						updateWheel();
					}, 1000);
				}
			}
		}

		// Handle game mode change
		function handleGameModeChange() {
			if (gameMode.value === 'first') {
				// Restore original names if switching from last man standing
				names = [...originalNames];
				updateNameList();
				updateWheel();
			} else if (gameMode.value === 'last') {
				// Reset history when starting last man standing
				winHistory = [];
				updateHistoryList();
			}
			
			updateRemainingDisplay();
		}

		// Update remaining display based on game mode
		function updateRemainingDisplay() {
			if (gameMode.value === 'last') {
				remainingDisplay.innerHTML = `<strong>Remaining:</strong> ${names.length} contestants`;
				remainingDisplay.style.display = 'block';
			} else {
				remainingDisplay.style.display = 'none';
			}
		}

		// Open the import/export modal
		function openImportExportModal() {
			namesTextarea.value = names.join('\n');
			importExportModal.style.display = 'flex';
		}

		// Close the import/export modal
		function closeImportExportModal() {
			importExportModal.style.display = 'none';
		}

		// Save imported names
		function saveImportedNames(e) {
			e.preventDefault();
			const importedText = namesTextarea.value.trim();
			
			if (importedText) {
				// Split by new lines and filter empty lines
				const newNames = importedText
					.split('\n')
					.map(name => name.trim())
					.filter(name => name.length > 0);
				
				// Deduplicate names
				const uniqueNames = [...new Set(newNames)];
				
				names = uniqueNames;
				saveNames();
				updateNameList();
				updateWheel();
			}
			
			closeImportExportModal();
		}

		// Reset all data
		function resetAll() {
			if (confirm('Are you sure you want to reset all data? This cannot be undone.')) {
				names = [];
				originalNames = [];
				currentNames = [];
				winHistory = [];
				saveNames();
				updateNameList();
				updateWheel();
				winnerDisplay.textContent = 'Spin to find out!';
			}
		}

		// Update spin duration display
		function updateSpinDurationDisplay() {
			spinDurationValue.textContent = spinDuration.value;
		}

		// Utility function to shuffle array
		function shuffleArray(array) {
			for (let i = array.length - 1; i > 0; i--) {
				const j = Math.floor(Math.random() * (i + 1));
				[array[i], array[j]] = [array[j], array[i]];
			}
			return array;
		}

		// Initialize the app when the page loads
		document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>			
