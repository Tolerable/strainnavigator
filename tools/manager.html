<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="https://accounts.google.com/gsi/client" async defer></script>
    <title>Seeds Banked - ᵗʰᵉ Rev™</title>
    <style>
        :root {
            --cannabis-green: #2D5E32;
            --cannabis-light-green: #68A357;
            --cannabis-dark-green: #1A3C20;
            --cannabis-brown: #604020;
            --cannabis-cream: #F8F6E9;
            --cannabis-purple: #5D4A7E;
            --count-bg: rgba(93, 74, 126, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--cannabis-cream);
            color: #333;
            line-height: 1.6;
        }
        
        header {
            background: linear-gradient(135deg, var(--cannabis-dark-green), var(--cannabis-green));
            color: white;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-left {
            flex: 1;
            text-align: left;
        }
        
        .header-center {
            flex: 2;
            text-align: center;
        }
        
        .header-right {
            flex: 1;
            text-align: right;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            justify-content: flex-end;
        }
        
        .user-profile img {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            margin-right: 10px;
            background-color: white;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .subtitle {
            font-size: 1.2rem;
            font-weight: 300;
            opacity: 0.9;
        }
        
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1.5rem;
        }
        
        .tab-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        
        .tabs {
            display: flex;
            background-color: var(--cannabis-light-green);
        }
        
        .tab {
            padding: 1rem 1.5rem;
            cursor: pointer;
            background-color: transparent;
            color: white;
            font-weight: 600;
            border: none;
            transition: background-color 0.3s;
            font-size: 1rem;
            flex: 1;
            text-align: center;
        }
        
        .tab.active {
            background-color: var(--cannabis-dark-green);
        }
        
        .tab:hover:not(.active) {
            background-color: rgba(0, 0, 0, 0.1);
        }
        
        .tab-content {
            padding: 2rem;
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* View Seeds Tab Content */
        .search-container {
            margin-bottom: 1.5rem;
            display: flex;
            gap: 1rem;
        }
        
        .search-input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .search-btn {
            background-color: var(--cannabis-green);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .filter-btn {
            background-color: #f0f0f0;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .filter-btn.active {
            background-color: var(--cannabis-purple);
            color: white;
        }
        
        .seed-list {
            list-style: none;
        }
        
        .seed-item {
            padding: 1rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .seed-item:last-child {
            border-bottom: none;
        }
        
        .seed-name {
            font-weight: 600;
            color: var(--cannabis-dark-green);
        }
        
        .seed-details {
            color: #666;
            font-size: 0.9rem;
        }
        
        .seed-info {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }
        
        .seed-count {
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--cannabis-purple);
            margin-bottom: 0.3rem;
            background-color: var(--count-bg);
            padding: 0.2rem 0.6rem;
            border-radius: 4px;
        }
        
        .seed-breeder {
            background-color: var(--cannabis-light-green);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
        }
        
        .run-mark {
            display: inline-block;
            color: var(--cannabis-purple);
            font-weight: bold;
            margin-left: 0.5rem;
        }
        
        /* Add/Edit Seeds Tab Content */
        .seed-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group.full-width {
            grid-column: 1 / span 2;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--cannabis-dark-green);
        }
        
        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .seed-actions {
            grid-column: 1 / span 2;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        /* Button Styles */
        button {
            background-color: var(--cannabis-green);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: var(--cannabis-dark-green);
        }
        
        button.secondary {
            background-color: #6c757d;
        }
        
        button.secondary:hover {
            background-color: #5a6268;
        }
        
        button.danger {
            background-color: #dc3545;
        }
        
        button.danger:hover {
            background-color: #c82333;
        }
        
        /* User Management Tab */
        .user-selection {
            margin-bottom: 2rem;
        }
        
        .user-list {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .user-card {
            background-color: white;
            border-radius: 6px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1rem;
            min-width: 200px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .user-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }
        
        .user-card.active {
            border: 2px solid var(--cannabis-purple);
        }
        
        .user-card-header {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .user-card-header img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }
        
        .user-card-name {
            font-weight: 600;
            color: var(--cannabis-dark-green);
        }
        
        .user-card-count {
            background-color: var(--count-bg);
            color: var(--cannabis-purple);
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.9rem;
            margin-top: 0.5rem;
            display: inline-block;
        }
        
        /* Loading */
        .loader {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }
        
        .loader:after {
            content: " ";
            display: block;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 6px solid var(--cannabis-green);
            border-color: var(--cannabis-green) transparent var(--cannabis-green) transparent;
            animation: loader 1.2s linear infinite;
        }
        
        @keyframes loader {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        /* Messages */
        .error-message {
            color: #d32f2f;
            text-align: center;
            padding: 2rem;
        }
        
        .placeholder-message {
            padding: 2rem;
            text-align: center;
            color: #666;
        }
        
        .placeholder-message h3 {
            color: var(--cannabis-dark-green);
            margin-bottom: 1rem;
        }
        
        .success-message {
            background-color: #d4edda;
            color: #155724;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            text-align: center;
        }
        
        /* Edit/Delete Actions */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .edit-btn, .delete-btn {
            background-color: transparent;
            border: none;
            padding: 0.3rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            color: #666;
        }
        
        .edit-btn:hover {
            color: var(--cannabis-green);
        }
        
        .delete-btn:hover {
            color: #dc3545;
        }
        
        /* Footer */
        footer {
            text-align: center;
            padding: 2rem;
            margin-top: 2rem;
            color: #666;
            font-size: 0.9rem;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                padding: 0.75rem;
            }
            
            .seed-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .seed-info {
                align-items: flex-start;
                margin-top: 0.5rem;
            }
            
            .seed-form {
                grid-template-columns: 1fr;
            }
            
            .form-group.full-width {
                grid-column: 1;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-left">
            <!-- Empty for now, could add a logo -->
        </div>
        <div class="header-center">
            <div class="subtitle">Seeds Banked - ᵗʰᵉ Rev™</div>
        </div>
        <div class="header-right">
            <div class="user-profile">
                <img id="user-image" src="https://via.placeholder.com/36" alt="User">
                <span id="user-name">Sign In</span>
            </div>
        </div>
    </header>
    
    <div class="container">
        <!-- Auth Container - Shown only when not logged in -->
		<div id="auth-container" class="tab-container" style="display: block;">
			<div class="placeholder-message">
				<h3>Welcome to Seed Collection Manager</h3>
				<p>Please sign in with your Google account to manage your seed collection.</p>
				<div id="g_id_onload"
					 data-client_id="1084684082826-tm0q6a2n0akgft065ie5irgth1fogo7c.apps.googleusercontent.com"
					 data-callback="handleCredentialResponse"
					 data-auto_prompt="false"
					 data-prompt_parent_id="g_id_onload">
				</div>
				<div class="g_id_signin"
					 data-type="standard"
					 data-size="large"
					 data-theme="outline"
					 data-text="sign_in_with"
					 data-shape="rectangular"
					 data-logo_alignment="center">
				</div>
			</div>
		</div>
        
        <!-- Main Container - Shown only when logged in -->
        <div id="main-container" class="tab-container" style="display: none;">
            <div class="tabs">
                <button class="tab active" data-tab="view-seeds">View Seeds</button>
                <button class="tab" data-tab="add-edit-seeds">Add/Edit Seeds</button>
                <button class="tab" data-tab="user-collections">User Collections</button>
            </div>
            
            <!-- View Seeds Tab -->
            <div id="view-seeds" class="tab-content active">
                <div class="search-container">
                    <input type="text" id="search-input" class="search-input" placeholder="Search seeds by name, breeder, etc.">
                    <button id="search-btn" class="search-btn">Search</button>
                </div>
                <div class="filters">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="reg">REG</button>
                    <button class="filter-btn" data-filter="fem">FEM</button>
                    <button class="filter-btn" data-filter="auto">AUTO</button>
                    <button class="filter-btn" data-filter="photo">PHOTO</button>
                    <button class="filter-btn" data-filter="fast">FAST</button>
                </div>
                <div id="seed-content" class="seed-content">
                    <div class="loader"></div>
                </div>
            </div>
            
            <!-- Add/Edit Seeds Tab -->
            <div id="add-edit-seeds" class="tab-content">
                <div id="form-messages"></div>
                
                <form id="seed-form" class="seed-form">
                    <input type="hidden" id="seed-id" name="seed-id">
                    
                    <div class="form-group">
                        <label for="strain">Strain Name*</label>
                        <input type="text" id="strain" name="strain" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="breeder">Breeder/Source*</label>
                        <input type="text" id="breeder" name="breeder" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="type">Type*</label>
                        <select id="type" name="type" required>
                            <option value="">-- Select Type --</option>
                            <option value="PHOTO REG">PHOTO REG</option>
                            <option value="PHOTO FEM">PHOTO FEM</option>
                            <option value="AUTO FEM">AUTO FEM</option>
                            <option value="AUTO REG">AUTO REG</option>
                            <option value="FAST PHOTO FEM">FAST PHOTO FEM</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="count">Count*</label>
                        <input type="number" id="count" name="count" min="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="parent1">Parent 1</label>
                        <input type="text" id="parent1" name="parent1">
                    </div>
                    
                    <div class="form-group">
                        <label for="parent2">Parent 2</label>
                        <input type="text" id="parent2" name="parent2">
                    </div>
                    
                    <div class="form-group">
                        <label for="run">Run Status</label>
                        <select id="run" name="run">
                            <option value="">Not Run</option>
                            <option value="X">Run (X)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="notes">Notes</label>
                        <textarea id="notes" name="notes" rows="3"></textarea>
                    </div>
                    
                    <div class="seed-actions">
                        <button type="button" id="reset-form-btn" class="secondary">Reset</button>
                        <button type="submit" id="save-seed-btn">Save Seed</button>
                    </div>
                </form>
            </div>
            
            <!-- User Collections Tab -->
            <div id="user-collections" class="tab-content">
                <div class="user-selection">
                    <h3>Available Collections</h3>
                    <p>Select a user to view their seed collection.</p>
                    <div id="user-list" class="user-list">
                        <div class="loader"></div>
                    </div>
                </div>
                
                <div id="selected-user-content" style="display: none;">
                    <h3>Selected Collection: <span id="selected-user-name"></span></h3>
                    <div class="search-container">
                        <input type="text" id="user-search-input" class="search-input" placeholder="Search this collection">
                        <button id="user-search-btn" class="search-btn">Search</button>
                    </div>
                    <div id="user-seed-content" class="seed-content">
                        <div class="loader"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        &copy; 2025 StrainNavigator.com | Collaborative Seed Collection Tracker
    </footer>      
    <script>

		// Configuration
		const MASTER_SHEET_ID = '1A7kFjfw6cjmQQOwz-5liWVGgFK0K5lwS8AfIZ_Zthbg';
		
		// Global variables
		let userToken = null;
		let userProfile = null;
		let userSheetId = null;
		let currentTab = 'view-seeds';
		let seedsData = [];
		let editingSeedIndex = -1;
		let userRegistry = [];
		let selectedUserSheetId = null;
		
	document.addEventListener('DOMContentLoaded', function() {

		// Check if we're returning from OAuth
		if (window.location.hash && window.location.hash.includes('access_token=')) {
			console.log('Detected access token in URL hash');
			
			// Extract token from URL
			const params = new URLSearchParams(window.location.hash.substring(1));
			userToken = params.get('access_token');
			console.log('Access token obtained from redirect');
			
			// Clear the hash
			window.history.replaceState({}, document.title, window.location.pathname);
			
			// Check if we were waiting for authorization
			if (localStorage.getItem('waitingForAuth') === 'true') {
				console.log('Resuming from authorization redirect');
				
				// Restore user profile from localStorage
				userProfile = {
					name: localStorage.getItem('userName') || 'User',
					email: localStorage.getItem('userEmail') || '',
					picture: localStorage.getItem('userPicture') || '',
					id: localStorage.getItem('userEmail') || ''  // Use email as ID
				};
				
				// Clear stored data
				localStorage.removeItem('waitingForAuth');
				localStorage.removeItem('userName');
				localStorage.removeItem('userEmail');
				localStorage.removeItem('userPicture');
				
				// Update UI
				document.getElementById('auth-container').style.display = 'none';
				document.getElementById('main-container').style.display = 'block';
				document.getElementById('user-name').textContent = userProfile.name;
				document.getElementById('user-image').src = userProfile.picture || 'https://via.placeholder.com/36';
				
				// Continue with spreadsheet operations
				setTimeout(async () => {
					try {
						await getUserSpreadsheet();
						await loadUserSeeds();
						await loadUserRegistry();
					} catch (error) {
						console.error('Error initializing after redirect:', error);
						alert('There was an error setting up your seed collection. Please try again.');
					}
				}, 500);
			}
		}
	
		// Initialize the UI
		setupTabs();
		setupFormHandling();

		// Set up Google Sign-In - IMPORTANT: This exposes the handler to window scope
		window.handleCredentialResponse = async function(response) {
			console.log('Sign-in response received:', response);
			
			// Get the token - we need to extract the right type of token
			userToken = response.credential;
			
			try {
				// Decode the JWT to get user info
				const payload = parseJwtResponse(userToken);
				userProfile = {
					id: payload.sub,
					name: payload.name,
					email: payload.email,
					picture: payload.picture
				};
				
				console.log('User profile:', userProfile);
				
				// Update UI
				document.getElementById('auth-container').style.display = 'none';
				document.getElementById('main-container').style.display = 'block';
				document.getElementById('user-name').textContent = userProfile.name;
				document.getElementById('user-image').src = userProfile.picture;
				
				// Get access token for API calls via token exchange
				await exchangeToken();
				
				// Now proceed with spreadsheet operations
				await getUserSpreadsheet();
				await loadUserSeeds();
				await loadUserRegistry();
			} catch (error) {
				console.error('Error processing sign-in:', error);
				alert('There was an error signing in. Please try again.');
			}
		};

		// Function to continue after authorization
		async function afterAuthorization() {
			try {
				// Get user profile information
				const response = await fetch('https://www.googleapis.com/oauth2/v3/userinfo', {
					headers: {
						'Authorization': `Bearer ${userToken}`
					}
				});
				
				if (!response.ok) {
					throw new Error('Failed to get user profile');
				}
				
				const userData = await response.json();
				userProfile = {
					id: userData.sub,
					name: userData.name,
					email: userData.email,
					picture: userData.picture
				};
				
				// Update UI
				document.getElementById('auth-container').style.display = 'none';
				document.getElementById('main-container').style.display = 'block';
				document.getElementById('user-name').textContent = userProfile.name;
				document.getElementById('user-image').src = userProfile.picture;
				
				// Proceed with spreadsheet operations
				await getUserSpreadsheet();
				await loadUserSeeds();
				await loadUserRegistry();
			} catch (error) {
				console.error('Error processing authorization:', error);
				alert('There was an error authorizing. Please try again.');
			}
		}

		async function exchangeToken() {
			return new Promise((resolve, reject) => {
				// Create a simple form for direct authorization
				const authForm = document.createElement('div');
				authForm.style.position = 'fixed';
				authForm.style.top = '50%';
				authForm.style.left = '50%';
				authForm.style.transform = 'translate(-50%, -50%)';
				authForm.style.background = 'white';
				authForm.style.padding = '20px';
				authForm.style.borderRadius = '8px';
				authForm.style.boxShadow = '0 4px 12px rgba(0,0,0,0.2)';
				authForm.style.zIndex = '9999';
				
				authForm.innerHTML = `
					<h3 style="margin-bottom: 20px;">API Authorization Required</h3>
					<p>To manage your seed collection, please authorize this app to access your Google Sheets.</p>
					<p style="margin-top: 10px; font-style: italic; font-size: 0.9em;">This requires additional permissions beyond just sign-in.</p>
					<div style="display: flex; justify-content: space-between; margin-top: 20px;">
						<button id="auth-cancel" style="padding: 8px 16px; background: #ddd; border: none; border-radius: 4px; cursor: pointer;">Cancel</button>
						<a id="auth-proceed" href="#" style="padding: 8px 16px; background: #2D5E32; color: white; border: none; border-radius: 4px; cursor: pointer; text-decoration: none; display: inline-block;">Authorize</a>
					</div>
				`;
				
				document.body.appendChild(authForm);
				
				// Add event listeners
				document.getElementById('auth-cancel').addEventListener('click', () => {
					document.body.removeChild(authForm);
					reject(new Error('Authorization cancelled'));
				});
				
				// Use a new popup window approach instead of redirect
				document.getElementById('auth-proceed').addEventListener('click', (e) => {
					e.preventDefault();
					document.body.removeChild(authForm);
					
					// Create an access token request through implicit grant
					const scopes = encodeURIComponent('https://www.googleapis.com/auth/spreadsheets https://www.googleapis.com/auth/drive.file');
					const clientId = '1084684082826-tm0q6a2n0akgft065ie5irgth1fogo7c.apps.googleusercontent.com';
					
					// Launch a popup for auth
					const width = 600;
					const height = 600;
					const left = (window.innerWidth - width) / 2;
					const top = (window.innerHeight - height) / 2;
					
					const authUrl = `https://accounts.google.com/o/oauth2/v2/auth?client_id=${clientId}&response_type=token&scope=${scopes}&redirect_uri=https://strainnavigator.com/oauth-callback.html`;
					
					const authWindow = window.open(
						authUrl,
						'google-oauth',
						`width=${width},height=${height},left=${left},top=${top}`
					);
					
					// Poll for completion
					const pollTimer = setInterval(() => {
						try {
							// When popup gets redirected to our callback page
							if (authWindow.location.hostname === window.location.hostname) {
								clearInterval(pollTimer);
								
								// Extract token from hash
								const hash = authWindow.location.hash;
								const params = new URLSearchParams(hash.substring(1));
								const token = params.get('access_token');
								
								if (token) {
									userToken = token; // Save the token
									authWindow.close();
									resolve(token);
								} else {
									authWindow.close();
									reject(new Error('Failed to get access token'));
								}
							}
						} catch (e) {
							// Permission error when trying to access cross-origin window
							// This is normal until redirect happens
						}
					}, 500);
					
					// Set a timeout
					setTimeout(() => {
						clearInterval(pollTimer);
						if (!authWindow.closed) {
							authWindow.close();
							reject(new Error('Authorization timed out'));
						}
					}, 120000); // 2 minute timeout
				});
			});
		}

		async function directAuthorization() {
			return new Promise((resolve, reject) => {
				// Create a simple form for direct authorization
				const authForm = document.createElement('div');
				authForm.style.position = 'fixed';
				authForm.style.top = '50%';
				authForm.style.left = '50%';
				authForm.style.transform = 'translate(-50%, -50%)';
				authForm.style.background = 'white';
				authForm.style.padding = '20px';
				authForm.style.borderRadius = '8px';
				authForm.style.boxShadow = '0 4px 12px rgba(0,0,0,0.2)';
				authForm.style.zIndex = '9999';
				
				authForm.innerHTML = `
					<h3 style="margin-bottom: 20px;">API Authorization Required</h3>
					<p>To manage your seed collection, please authorize this app to access your Google Sheets.</p>
					<div style="display: flex; justify-content: space-between; margin-top: 20px;">
						<button id="auth-cancel" style="padding: 8px 16px; background: #ddd; border: none; border-radius: 4px; cursor: pointer;">Cancel</button>
						<button id="auth-proceed" style="padding: 8px 16px; background: #4285F4; color: white; border: none; border-radius: 4px; cursor: pointer;">Authorize</button>
					</div>
				`;
				
				document.body.appendChild(authForm);
				
				// Add event listeners
				document.getElementById('auth-cancel').addEventListener('click', () => {
					document.body.removeChild(authForm);
					reject(new Error('Authorization cancelled'));
				});
				
				document.getElementById('auth-proceed').addEventListener('click', () => {
					document.body.removeChild(authForm);
					
					// Open the OAuth authorization page
					const scopes = encodeURIComponent('https://www.googleapis.com/auth/spreadsheets https://www.googleapis.com/auth/drive.file');
					const clientId = '1084684082826-tm0q6a2n0akgft065ie5irgth1fogo7c.apps.googleusercontent.com';
					const redirectUri = encodeURIComponent(window.location.origin + window.location.pathname);
					
					const authUrl = `https://accounts.google.com/o/oauth2/v2/auth?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=token&scope=${scopes}`;
					
					// Store that we're waiting for authorization
					localStorage.setItem('waitingForAuth', 'true');
					
					// Open the authorization window
					window.location.href = authUrl;
				});
			});
		}

		async function debugFetchWithAuth(url, options = {}) {
			console.log(`DEBUG: Fetching ${url}`);
			try {
				const response = await fetchWithAuth(url, options);
				
				// Clone the response so we can both log it and return it
				const clonedResponse = response.clone();
				
				try {
					const data = await clonedResponse.json();
					console.log('DEBUG: Response data:', data);
				} catch (e) {
					console.log('DEBUG: Response is not JSON:', await clonedResponse.text());
				}
				
				return response;
			} catch (error) {
				console.error('DEBUG: Fetch error:', error);
				throw error;
			}
		}
		
		function parseJwtResponse(token) {
			const base64Url = token.split('.')[1];
			const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
			const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
				return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
			}).join(''));
			return JSON.parse(jsonPayload);
		}
		
		async function getUserSpreadsheet() {
			// First, check if the user has a spreadsheet in the registry
			const registeredSheetId = await checkUserInRegistry();
			
			if (registeredSheetId) {
				// User already has a spreadsheet
				userSheetId = registeredSheetId;
				return userSheetId;
			} else {
				// Create a new spreadsheet for the user
				const newSheetId = await createUserSpreadsheet();
				// Register the new spreadsheet
				await registerUserSpreadsheet(newSheetId);
				userSheetId = newSheetId;
				return userSheetId;
			}
		}
		
		async function checkUserInRegistry() {
			try {
				// Check if UserRegistry sheet exists by trying to access it
				const response = await fetchWithAuth(`https://sheets.googleapis.com/v4/spreadsheets/${MASTER_SHEET_ID}/values/UserRegistry!A:C`);
				
				if (!response.ok) {
					// Sheet likely doesn't exist, create it
					await createUserRegistry();
					return null;
				}
				
				const data = await response.json();
				const values = data.values || [];
				
				// Skip header row if present
				const startIndex = values[0] && values[0][0] === 'UserId' ? 1 : 0;
				
				for (let i = startIndex; i < values.length; i++) {
					if (values[i][0] === userProfile.id) {
						// User found in registry
						return values[i][2]; // Return the SheetId
					}
				}
				
				// User not found in registry
				return null;
			} catch (error) {
				console.error('Error checking user in registry:', error);
				// If we can't access the registry, we might need to create it
				await createUserRegistry();
				return null;
			}
		}
		
		async function createUserRegistry() {
			try {
				// Create UserRegistry sheet
				await fetchWithAuth(`https://sheets.googleapis.com/v4/spreadsheets/${MASTER_SHEET_ID}:batchUpdate`, {
					method: 'POST',
					body: JSON.stringify({
						requests: [{
							addSheet: {
								properties: {
									title: 'UserRegistry',
									gridProperties: {
										rowCount: 1000,
										columnCount: 3
									}
								}
							}
						}]
					})
				});
				
				// Add header row
				await fetchWithAuth(`https://sheets.googleapis.com/v4/spreadsheets/${MASTER_SHEET_ID}/values/UserRegistry!A1:C1?valueInputOption=RAW`, {
					method: 'PUT',
					body: JSON.stringify({
						values: [['UserId', 'UserName', 'SheetId']]
					})
				});
				
				return true;
			} catch (error) {
				console.error('Error creating user registry:', error);
				return false;
			}
		}
		
		async function createUserSpreadsheet() {
			try {
				console.log('Creating new spreadsheet...');
				
				// First create the spreadsheet
				const response = await fetchWithAuth('https://sheets.googleapis.com/v4/spreadsheets', {
					method: 'POST',
					body: JSON.stringify({
						properties: {
							title: `Seed Collection - ${userProfile.name}`
						},
						sheets: [{
							properties: {
								title: 'Seeds',
								gridProperties: {
									rowCount: 1000,
									columnCount: 10
								}
							}
						}]
					})
				});
				
				const data = await response.json();
				console.log('Created spreadsheet:', data);
				const spreadsheetId = data.spreadsheetId;
				
				if (!spreadsheetId) {
					console.error('Failed to get spreadsheetId from response');
					return null;
				}
				
				console.log('Setting spreadsheet permissions...');
				
				// Now make it accessible to others (this requires Drive API)
				try {
					const permissionResponse = await fetch(`https://www.googleapis.com/drive/v3/files/${spreadsheetId}/permissions`, {
						method: 'POST',
						headers: {
							'Authorization': `Bearer ${userToken}`,
							'Content-Type': 'application/json'
						},
						body: JSON.stringify({
							role: 'reader',
							type: 'anyone'
						})
					});
					
					if (!permissionResponse.ok) {
						console.warn('Could not set spreadsheet permissions:', await permissionResponse.text());
					} else {
						console.log('Spreadsheet permissions set successfully');
					}
				} catch (permError) {
					console.warn('Error setting permissions:', permError);
					// Continue anyway since this isn't critical
				}
				
				// Add the header row
				console.log('Adding header row...');
				const headerResponse = await fetchWithAuth(`https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/Seeds!A1:G1?valueInputOption=RAW`, {
					method: 'PUT',
					body: JSON.stringify({
						values: [['STRAIN', 'REG / FEM', 'BREEDER', 'COUNT', 'PARENT1', 'PARENT2', 'RUN']]
					})
				});
				
				if (!headerResponse.ok) {
					console.error('Failed to add header row:', await headerResponse.text());
				} else {
					console.log('Header row added successfully');
				}
				
				return spreadsheetId;
			} catch (error) {
				console.error('Error creating user spreadsheet:', error);
				return null;
			}
		}
		
		async function registerUserSpreadsheet(sheetId) {
			try {
				await fetchWithAuth(`https://sheets.googleapis.com/v4/spreadsheets/${MASTER_SHEET_ID}/values/UserRegistry!A:C:append?valueInputOption=RAW`, {
					method: 'POST',
					body: JSON.stringify({
						values: [[userProfile.id, userProfile.name, sheetId]]
					})
				});
				return true;
			} catch (error) {
				console.error('Error registering user spreadsheet:', error);
				return false;
			}
		}
		
		async function loadUserSeeds() {
			if (!userSheetId) {
				console.error('No userSheetId available');
				return;
			}
			
			const contentContainer = document.getElementById('seed-content');
			contentContainer.innerHTML = '<div class="loader"></div>';
			
			try {
				console.log('Loading seeds from spreadsheet:', userSheetId);
				
				// First verify we can access the spreadsheet
				const testResponse = await fetchWithAuth(`https://sheets.googleapis.com/v4/spreadsheets/${userSheetId}?fields=properties.title`);
				
				if (!testResponse.ok) {
					const errorText = await testResponse.text();
					console.error('Cannot access spreadsheet:', errorText);
					contentContainer.innerHTML = `<div class="error-message">Error accessing your seed collection. Details: ${errorText}</div>`;
					return;
				}
				
				const testData = await testResponse.json();
				console.log('Verified access to spreadsheet:', testData.properties.title);
				
				// Now get the values
				const response = await fetchWithAuth(`https://sheets.googleapis.com/v4/spreadsheets/${userSheetId}/values/Seeds!A:G`);
				
				if (!response.ok) {
					const errorText = await response.text();
					console.error('Error fetching seed data:', errorText);
					contentContainer.innerHTML = `<div class="error-message">Error loading seed data. Details: ${errorText}</div>`;
					return;
				}
				
				const data = await response.json();
				console.log('Received seed data:', data);
				
				const values = data.values || [];
				
				// Skip header row if present
				const startIndex = values[0] && values[0][0] === 'STRAIN' ? 1 : 0;
				
				seedsData = [];
				for (let i = startIndex; i < values.length; i++) {
					if (values[i] && values[i].length > 0 && values[i][0]) {  // Skip empty rows
						seedsData.push({
							strain: values[i][0] || '',
							type: values[i][1] || '',
							breeder: values[i][2] || '',
							count: values[i][3] || '',
							parent1: values[i][4] || '',
							parent2: values[i][5] || '',
							run: values[i][6] || '',
							row: i + 1  // Store the row index for updates
						});
					}
				}
				
				console.log('Processed seed data:', seedsData);
				displayUserSeeds(seedsData);
			} catch (error) {
				console.error('Exception in loadUserSeeds:', error);
				contentContainer.innerHTML = `<div class="error-message">Error loading your seed collection: ${error.message}</div>`;
			}
		}
		
		async function fetchWithAuth(url, options = {}) {
			if (!userToken) {
				console.error('No auth token available');
				throw new Error('Authentication required');
			}
			
			if (!options.headers) {
				options.headers = {};
			}
			
			// The token we get from Google Sign-In is already an ID token, 
			// but for API access we need to specify it's a Bearer token
			options.headers['Authorization'] = `Bearer ${userToken}`;
			options.headers['Content-Type'] = 'application/json';
			
			console.log(`Fetching ${url} with auth`);
			const response = await fetch(url, options);
			
			if (!response.ok) {
				// Log the error details
				console.error(`API error (${response.status}):`, await response.text());
			}
			
			return response;
		}

		// The rest of your display and interaction functions remain the same
		// Just remove references to gapi and use fetchWithAuth instead
		
		// Keep all your existing UI functions like displayUserSeeds, setupTabs, etc.
		
		function displayUserSeeds(seeds) {
			const contentContainer = document.getElementById('seed-content');
			
			if (seeds.length === 0) {
				contentContainer.innerHTML = `
					<div class="placeholder-message">
						<h3>No seeds in your collection yet</h3>
						<p>Add your first seed by switching to the "Add/Edit Seeds" tab.</p>
					</div>
				`;
				return;
			}
			
			let html = '<ul class="seed-list">';
			
			seeds.forEach((seed, index) => {
				const details = [];
				
				if (seed.type) details.push(`Type: ${seed.type}`);
				if (seed.count) details.push(`Count: ${seed.count}`);
				
				if (seed.parent1 || seed.parent2) {
					let genetics = 'Genetics: ';
					if (seed.parent1 && seed.parent2) {
						genetics += `${seed.parent1} × ${seed.parent2}`;
					} else if (seed.parent1) {
						genetics += seed.parent1;
					} else if (seed.parent2) {
						genetics += seed.parent2;
					}
					details.push(genetics);
				}
				
				html += `
					<li class="seed-item" data-index="${index}">
						<div>
							<div class="seed-name">${seed.strain} ${seed.run === 'X' ? '<span class="run-mark">✓</span>' : ''}</div>
							${details.length > 0 ? `<div class="seed-details">${details.join(' • ')}</div>` : ''}
						</div>
						<div class="seed-info">
							<div class="seed-count">${seed.count || ''}</div>
							<div class="seed-breeder">${seed.breeder}</div>
							<div class="action-buttons">
								<button class="edit-btn" data-index="${index}">✏️</button>
								<button class="delete-btn" data-index="${index}">🗑️</button>
							</div>
						</div>
					</li>
				`;
			});
			
			html += '</ul>';
			contentContainer.innerHTML = html;
			
			// Add event listeners for edit and delete buttons
			document.querySelectorAll('.edit-btn').forEach(btn => {
				btn.addEventListener('click', function(e) {
					e.stopPropagation();
					const index = parseInt(this.dataset.index);
					openEditForm(index);
				});
			});
			
			document.querySelectorAll('.delete-btn').forEach(btn => {
				btn.addEventListener('click', function(e) {
					e.stopPropagation();
					const index = parseInt(this.dataset.index);
					deleteSeed(index);
				});
			});
			
			// Set up search and filter
			setupSearchAndFilter();
		}
		
		function setupTabs() {
			const tabs = document.querySelectorAll('.tab');
			
			tabs.forEach(tab => {
				tab.addEventListener('click', function() {
					const tabId = this.dataset.tab;
					
					// Remove active class from all tabs and contents
					document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
					document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
					
					// Add active class to clicked tab and corresponding content
					this.classList.add('active');
					document.getElementById(tabId).classList.add('active');
					
					currentTab = tabId;
					
					// If switching to user collections tab, load user registry
					if (tabId === 'user-collections') {
						loadUserRegistry();
					}
				});
			});
		}
		
		function setupFormHandling() {
			const form = document.getElementById('seed-form');
			const resetBtn = document.getElementById('reset-form-btn');
			
			// Reset form
			resetBtn.addEventListener('click', function() {
				resetSeedForm();
			});
			
			// Form submission
			form.addEventListener('submit', function(e) {
				e.preventDefault();
				
				const seedData = {
					strain: document.getElementById('strain').value,
					type: document.getElementById('type').value,
					breeder: document.getElementById('breeder').value,
					count: document.getElementById('count').value,
					parent1: document.getElementById('parent1').value,
					parent2: document.getElementById('parent2').value,
					run: document.getElementById('run').value
				};
				
				if (editingSeedIndex >= 0) {
					// Update existing seed
					updateSeed(editingSeedIndex, seedData);
				} else {
					// Add new seed
					addSeed(seedData);
				}
			});
		}
		
		function resetSeedForm() {
			document.getElementById('seed-form').reset();
			document.getElementById('seed-id').value = '';
			editingSeedIndex = -1;
			document.getElementById('save-seed-btn').textContent = 'Save Seed';
		}
		
		function openEditForm(index) {
			const seed = seedsData[index];
			
			// Switch to the edit tab
			document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
			document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
			document.querySelector('.tab[data-tab="add-edit-seeds"]').classList.add('active');
			document.getElementById('add-edit-seeds').classList.add('active');
			
			// Fill the form with seed data
			document.getElementById('seed-id').value = seed.row;
			document.getElementById('strain').value = seed.strain;
			document.getElementById('type').value = seed.type;
			document.getElementById('breeder').value = seed.breeder;
			document.getElementById('count').value = seed.count;
			document.getElementById('parent1').value = seed.parent1 || '';
			document.getElementById('parent2').value = seed.parent2 || '';
			document.getElementById('run').value = seed.run || '';
			
			// Update form state
			editingSeedIndex = index;
			document.getElementById('save-seed-btn').textContent = 'Update Seed';
		}
		
		async function addSeed(seedData) {
			// Show loading
			const formMessages = document.getElementById('form-messages');
			formMessages.innerHTML = '<div class="loader"></div>';
			
			try {
				// Prepare the values to append
				const values = [
					[
						seedData.strain,
						seedData.type,
						seedData.breeder,
						seedData.count,
						seedData.parent1,
						seedData.parent2,
						seedData.run
					]
				];
				
				// Append to the spreadsheet
				await fetchWithAuth(`https://sheets.googleapis.com/v4/spreadsheets/${userSheetId}/values/Seeds!A:G:append?valueInputOption=RAW`, {
					method: 'POST',
					body: JSON.stringify({
						values: values
					})
				});
				
				// Show success message
				formMessages.innerHTML = '<div class="success-message">Seed added successfully!</div>';
				
				// Reset the form
				resetSeedForm();
				
				// Reload the seeds
				loadUserSeeds();
				
				// Clear success message after 3 seconds
				setTimeout(() => {
					formMessages.innerHTML = '';
				}, 3000);
			} catch (error) {
				console.error('Error adding seed:', error);
				formMessages.innerHTML = '<div class="error-message">Error adding seed. Please try again.</div>';
			}
		}
		
		async function updateSeed(index, seedData) {
			// Show loading
			const formMessages = document.getElementById('form-messages');
			formMessages.innerHTML = '<div class="loader"></div>';
			
			try {
				const seed = seedsData[index];
				const rowIndex = seed.row;
				
				// Prepare the values to update
				const values = [
					[
						seedData.strain,
						seedData.type,
						seedData.breeder,
						seedData.count,
						seedData.parent1,
						seedData.parent2,
						seedData.run
					]
				];
				
				// Update the spreadsheet
				await fetchWithAuth(`https://sheets.googleapis.com/v4/spreadsheets/${userSheetId}/values/Seeds!A${rowIndex}:G${rowIndex}?valueInputOption=RAW`, {
					method: 'PUT',
					body: JSON.stringify({
						values: values
					})
				});
				
				// Show success message
				formMessages.innerHTML = '<div class="success-message">Seed updated successfully!</div>';
				
				// Reset the form
				resetSeedForm();
				
				// Reload the seeds
				loadUserSeeds();
				
				// Clear success message after 3 seconds
				setTimeout(() => {
					formMessages.innerHTML = '';
				}, 3000);
			} catch (error) {
				console.error('Error updating seed:', error);
				formMessages.innerHTML = '<div class="error-message">Error updating seed. Please try again.</div>';
			}
		}
		
		async function deleteSeed(index) {
			if (!confirm('Are you sure you want to delete this seed?')) {
				return;
			}
			
			try {
				const seed = seedsData[index];
				const rowIndex = seed.row;
				
				// Clear the row
				await fetchWithAuth(`https://sheets.googleapis.com/v4/spreadsheets/${userSheetId}/values/Seeds!A${rowIndex}:G${rowIndex}:clear`, {
					method: 'POST'
				});
				
				// Reload the seeds
				loadUserSeeds();
			} catch (error) {
				console.error('Error deleting seed:', error);
				alert('Error deleting seed. Please try again.');
			}
		}
		
		function setupSearchAndFilter() {
			// Search functionality
			const searchBtn = document.getElementById('search-btn');
			const searchInput = document.getElementById('search-input');
			
			searchBtn.addEventListener('click', performSearch);
			searchInput.addEventListener('keyup', function(e) {
				if (e.key === 'Enter') {
					performSearch();
				}
			});
			
			// Filter buttons
			document.querySelectorAll('.filter-btn').forEach(btn => {
				btn.addEventListener('click', function() {
					const filter = this.dataset.filter;
					filterSeeds(filter);
				});
			});
		}
		
		function performSearch() {
			const searchTerm = document.getElementById('search-input').value.trim().toLowerCase();
			
			document.querySelectorAll('.seed-item').forEach(item => {
				if (searchTerm === '') {
					item.style.display = '';
				} else {
					const text = item.textContent.toLowerCase();
					item.style.display = text.includes(searchTerm) ? '' : 'none';
				}
			});
		}
		
		function filterSeeds(filter) {
			// Update active button
			document.querySelectorAll('.filter-btn').forEach(btn => {
				btn.classList.toggle('active', btn.dataset.filter === filter);
			});
			
			// Filter seeds
			document.querySelectorAll('.seed-item').forEach(item => {
				const index = parseInt(item.dataset.index);
				const seed = seedsData[index];
				
				if (filter === 'all') {
					item.style.display = '';
				} else {
					const seedType = seed.type.toLowerCase();
					item.style.display = seedType.includes(filter.toLowerCase()) ? '' : 'none';
				}
			});
		}
		
		async function loadUserRegistry() {
			const userListContainer = document.getElementById('user-list');
			userListContainer.innerHTML = '<div class="loader"></div>';
			
			try {
				const response = await fetchWithAuth(`https://sheets.googleapis.com/v4/spreadsheets/${MASTER_SHEET_ID}/values/UserRegistry!A:C`);
				const data = await response.json();
				const values = data.values || [];
				
				// Skip header row if present
				const startIndex = values[0] && values[0][0] === 'UserId' ? 1 : 0;
				
				userRegistry = [];
				for (let i = startIndex; i < values.length; i++) {
					if (values[i].length >= 3 && values[i][0]) {  // Skip empty rows
						userRegistry.push({
							userId: values[i][0],
							userName: values[i][1],
							sheetId: values[i][2]
						});
					}
				}
				
				displayUserRegistry(userRegistry);
			} catch (error) {
				console.error('Error loading user registry:', error);
				userListContainer.innerHTML = '<div class="error-message">Error loading user registry. Please try again later.</div>';
			}
		}
		
		function displayUserRegistry(users) {
			const userListContainer = document.getElementById('user-list');
			
			if (users.length === 0) {
				userListContainer.innerHTML = '<p>No users have created collections yet.</p>';
				return;
			}
			
			let html = '';
			
			users.forEach(user => {
				// Mark the current user's card
				const isCurrentUser = user.userId === userProfile.id;
				const activeClass = selectedUserSheetId === user.sheetId ? 'active' : '';
				
				html += `
					<div class="user-card ${activeClass}" data-sheet-id="${user.sheetId}" data-user-name="${user.userName}">
						<div class="user-card-header">
							<img src="https://via.placeholder.com/40" alt="${user.userName}">
							<div class="user-card-name">${user.userName} ${isCurrentUser ? '(You)' : ''}</div>
						</div>
						<div class="user-card-count">View Collection</div>
					</div>
				`;
			});
			
			userListContainer.innerHTML = html;
			
			// Add event listeners to user cards
			document.querySelectorAll('.user-card').forEach(card => {
				card.addEventListener('click', function() {
					const sheetId = this.dataset.sheetId;
					const userName = this.dataset.userName;
					
					// Update selected card
					document.querySelectorAll('.user-card').forEach(c => c.classList.remove('active'));
					this.classList.add('active');
					
					// Load the selected user's seeds
					selectedUserSheetId = sheetId;
					document.getElementById('selected-user-name').textContent = userName;
					document.getElementById('selected-user-content').style.display = 'block';
					
					loadSelectedUserSeeds(sheetId);
				});
			});
		}
		
		async function loadSelectedUserSeeds(sheetId) {
			const contentContainer = document.getElementById('user-seed-content');
			contentContainer.innerHTML = '<div class="loader"></div>';
			
			try {
				const response = await fetchWithAuth(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/Seeds!A:G`);
				const data = await response.json();
				const values = data.values || [];
				
				// Skip header row if present
				const startIndex = values[0] && values[0][0] === 'STRAIN' ? 1 : 0;
				
				const selectedUserSeeds = [];
				for (let i = startIndex; i < values.length; i++) {
					if (values[i].length > 0 && values[i][0]) {  // Skip empty rows
						selectedUserSeeds.push({
							strain: values[i][0] || '',
							type: values[i][1] || '',
							breeder: values[i][2] || '',
							count: values[i][3] || '',
							parent1: values[i][4] || '',
							parent2: values[i][5] || '',
							run: values[i][6] || ''
						});
					}
				}
				
				displaySelectedUserSeeds(selectedUserSeeds);
			} catch (error) {
				console.error('Error loading selected user seeds:', error);
				contentContainer.innerHTML = '<div class="error-message">Error loading this collection. Please try again later.</div>';
			}
		}
		
		function displaySelectedUserSeeds(seeds) {
			const contentContainer = document.getElementById('user-seed-content');
			
			if (seeds.length === 0) {
				contentContainer.innerHTML = '<p>No seeds in this collection yet.</p>';
				return;
			}
			
			let html = '<ul class="seed-list">';
			
			seeds.forEach((seed) => {
				const details = [];
				
				if (seed.type) details.push(`Type: ${seed.type}`);
				if (seed.count) details.push(`Count: ${seed.count}`);
				
				if (seed.parent1 || seed.parent2) {
					let genetics = 'Genetics: ';
					if (seed.parent1 && seed.parent2) {
						genetics += `${seed.parent1} × ${seed.parent2}`;
					} else if (seed.parent1) {
						genetics += seed.parent1;
					} else if (seed.parent2) {
						genetics += seed.parent2;
					}
					details.push(genetics);
				}
				
				html += `
					<li class="seed-item">
						<div>
							<div class="seed-name">${seed.strain} ${seed.run === 'X' ? '<span class="run-mark">✓</span>' : ''}</div>
							${details.length > 0 ? `<div class="seed-details">${details.join(' • ')}</div>` : ''}
						</div>
						<div class="seed-info">
							<div class="seed-count">${seed.count || ''}</div>
							<div class="seed-breeder">${seed.breeder}</div>
						</div>
					</li>
				`;
			});
			
			html += '</ul>';
			contentContainer.innerHTML = html;
			
			// Set up search for this collection
			setupSelectedUserSearch();
		}
		
		function setupSelectedUserSearch() {
			const searchBtn = document.getElementById('user-search-btn');
			const searchInput = document.getElementById('user-search-input');
			
			searchBtn.addEventListener('click', performSelectedUserSearch);
			searchInput.addEventListener('keyup', function(e) {
				if (e.key === 'Enter') {
					performSelectedUserSearch();
				}
			});
		}
		
		function performSelectedUserSearch() {
			const searchTerm = document.getElementById('user-search-input').value.trim().toLowerCase();
			
			document.querySelectorAll('#user-seed-content .seed-item').forEach(item => {
				if (searchTerm === '') {
					item.style.display = '';
				} else {
					const text = item.textContent.toLowerCase();
					item.style.display = text.includes(searchTerm) ? '' : 'none';
				}
			});
		}
	});
    </script>
</body>
</html>
